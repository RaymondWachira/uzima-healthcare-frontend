<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uzima Healthcare - Smart Triage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.5s ease-out; }
    </style>
</head>
<body class="bg-gradient-to-br from-teal-50 via-blue-50 to-indigo-100 min-h-screen">
    
    <!-- Header -->
    <div class="bg-gradient-to-r from-teal-600 to-blue-600 shadow-lg">
        <div class="max-w-4xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between flex-wrap">
                <div class="flex items-center">
                    <div class="bg-white rounded-full p-3 mr-4 shadow-lg">
                        <span class="text-4xl">üè•</span>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-white">Uzima Healthcare</h1>
                        <p class="text-teal-100 text-sm font-medium">Smart Triage System</p>
                        <p class="text-teal-200 text-xs">Comprehensive Patient Assessment</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Impact Banner -->
    <div class="bg-gradient-to-r from-green-500 to-emerald-600 py-3">
        <div class="max-w-4xl mx-auto px-4">
            <div class="flex items-center justify-center gap-8 text-white text-sm font-semibold flex-wrap">
                <div class="flex items-center">
                    <span class="text-2xl mr-2">‚ö°</span>
                    <span>40% Wait Time Reduction</span>
                </div>
                <div class="flex items-center">
                    <span class="text-2xl mr-2">üë•</span>
                    <span>40% Capacity Increase</span>
                </div>
                <div class="flex items-center">
                    <span class="text-2xl mr-2">üòä</span>
                    <span>Better Patient Experience</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="max-w-4xl mx-auto px-4 py-8">
        
        <!-- Demo Buttons -->
        <div id="demo-buttons" class="mb-6 bg-white rounded-xl shadow-lg p-6 border-t-4 border-teal-500">
            <div class="flex items-center mb-4">
                <span class="text-2xl mr-3">üéØ</span>
                <div>
                    <p class="text-lg font-bold text-gray-800">Quick Demo</p>
                    <p class="text-sm text-gray-600">Click to see how Uzima routes different cases</p>
                </div>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <button onclick="loadDemo(0)" class="px-4 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg hover:from-purple-600 hover:to-purple-700 transition font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                    <div class="text-2xl mb-1">üë©</div>
                    <div class="text-xs">UTI Case</div>
                </button>
                <button onclick="loadDemo(1)" class="px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                    <div class="text-2xl mb-1">üö®</div>
                    <div class="text-xs">Emergency</div>
                </button>
                <button onclick="loadDemo(2)" class="px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                    <div class="text-2xl mb-1">üè†</div>
                    <div class="text-xs">Self-Care</div>
                </button>
                <button onclick="loadDemo(3)" class="px-4 py-3 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white rounded-lg hover:from-yellow-600 hover:to-yellow-700 transition font-medium shadow-md hover:shadow-lg transform hover:scale-105">
                    <div class="text-2xl mb-1">üë®‚Äç‚öïÔ∏è</div>
                    <div class="text-xs">Complex</div>
                </button>
            </div>
        </div>

        <!-- Triage Form -->
        <div id="triage-form-container" class="bg-white rounded-xl shadow-xl p-8 fade-in border-t-4 border-teal-500">
            <div class="mb-6 text-center">
                <div class="inline-block bg-teal-100 rounded-full p-4 mb-4">
                    <span class="text-5xl">üìã</span>
                </div>
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Patient Pre-Visit Assessment</h2>
                <p class="text-gray-600">Complete this comprehensive assessment for accurate triage</p>
                <div class="mt-4 inline-block bg-blue-50 px-4 py-2 rounded-lg">
                    <p class="text-sm text-blue-800">‚è±Ô∏è Takes <strong>3-4 minutes</strong> | Saves you <strong>30+ minutes</strong></p>
                </div>
            </div>

            <form id="triage-form" class="space-y-6">
                
                <!-- SECTION 1: PERSONAL INFORMATION -->
                <div class="border-l-4 border-teal-500 pl-4 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìù Personal Information</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- Phone Number -->
                        <div>
                            <label for="phone" class="block text-sm font-semibold text-gray-700 mb-2">
                                üì± Phone Number *
                            </label>
                            <input 
                                type="tel" 
                                id="phone" 
                                name="phone"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"
                                placeholder="+254712345678"
                                required
                            />
                        </div>

                        <!-- Patient Name -->
                        <div>
                            <label for="patient-name" class="block text-sm font-semibold text-gray-700 mb-2">
                                üë§ Full Name *
                            </label>
                            <input 
                                type="text" 
                                id="patient-name" 
                                name="patient-name"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"
                                placeholder="e.g., Grace Wanjiru"
                                required
                            />
                        </div>

                        <!-- Age -->
                        <div>
                            <label for="patient-age" class="block text-sm font-semibold text-gray-700 mb-2">
                                üéÇ Age *
                            </label>
                            <input 
                                type="number" 
                                id="patient-age" 
                                name="patient-age"
                                min="0"
                                max="120"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"
                                placeholder="e.g., 28"
                                required
                            />
                        </div>

                        <!-- Gender -->
                        <div>
                            <label for="gender" class="block text-sm font-semibold text-gray-700 mb-2">
                                ‚ößÔ∏è Gender *
                            </label>
                            <select 
                                id="gender" 
                                name="gender"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"
                                required
                            >
                                <option value="" disabled selected>Select gender...</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <!-- Weight -->
                        <div>
                            <label for="weight" class="block text-sm font-semibold text-gray-700 mb-2">
                                ‚öñÔ∏è Weight (kg)
                            </label>
                            <input 
                                type="number" 
                                id="weight" 
                                name="weight"
                                min="0"
                                step="0.1"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"
                                placeholder="e.g., 65"
                            />
                        </div>

                        <!-- Height -->
                        <div>
                            <label for="height" class="block text-sm font-semibold text-gray-700 mb-2">
                                üìè Height (cm)
                            </label>
                            <input 
                                type="number" 
                                id="height" 
                                name="height"
                                min="0"
                                step="0.1"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"
                                placeholder="e.g., 165"
                            />
                        </div>

                        <!-- Location -->
                        <div class="md:col-span-2">
                            <label for="location" class="block text-sm font-semibold text-gray-700 mb-2">
                                üìç County/Location
                            </label>
                            <input 
                                type="text" 
                                id="location" 
                                name="location"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition"
                                placeholder="e.g., Nairobi"
                            />
                        </div>
                    </div>
                </div>

                <!-- SECTION 2: MEDICAL HISTORY -->
                <div class="border-l-4 border-purple-500 pl-4 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üè• Medical History</h3>
                    
                    <!-- Allergies -->
                    <div class="mb-4">
                        <label for="allergies" class="block text-sm font-semibold text-gray-700 mb-2">
                            ‚ö†Ô∏è Known Allergies
                        </label>
                        <textarea 
                            id="allergies" 
                            name="allergies"
                            rows="2" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition"
                            placeholder="e.g., Penicillin, Peanuts, None"
                        ></textarea>
                    </div>

                    <!-- Current Medications -->
                    <div class="mb-4">
                        <label for="medications" class="block text-sm font-semibold text-gray-700 mb-2">
                            üíä Current Medications
                        </label>
                        <textarea 
                            id="medications" 
                            name="medications"
                            rows="2" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition"
                            placeholder="List any medications you're currently taking"
                        ></textarea>
                    </div>

                    <!-- Travel History -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            ‚úàÔ∏è Travel History (Last 14 Days)
                        </label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="travel" value="no" class="mr-2" checked>
                                <span>No travel</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="travel" value="domestic" class="mr-2">
                                <span>Domestic</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="travel" value="international" class="mr-2">
                                <span>International</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- SECTION 3: CURRENT SYMPTOMS -->
                <div class="border-l-4 border-red-500 pl-4 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">ü©∫ Current Symptoms</h3>

                    <!-- Chief Complaint -->
                    <div class="mb-4">
                        <label for="chief-complaint" class="block text-sm font-semibold text-gray-700 mb-2">
                            üí¨ What brings you in today? *
                        </label>
                        <textarea 
                            id="chief-complaint" 
                            name="chief-complaint"
                            rows="4" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition"
                            placeholder="Describe your main symptom or concern in detail..."
                            required
                        ></textarea>
                    </div>

                    <!-- Body Location -->
                    <div class="mb-4">
                        <label for="body-location" class="block text-sm font-semibold text-gray-700 mb-2">
                            üéØ Location of Symptoms
                        </label>
                        <select 
                            id="body-location" 
                            name="body-location"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition"
                        >
                            <option value="">Select body area...</option>
                            <option value="head">Head/Face</option>
                            <option value="neck">Neck</option>
                            <option value="chest">Chest</option>
                            <option value="abdomen">Abdomen/Stomach</option>
                            <option value="back">Back</option>
                            <option value="arms">Arms/Hands</option>
                            <option value="legs">Legs/Feet</option>
                            <option value="skin">Skin (general)</option>
                            <option value="multiple">Multiple areas</option>
                            <option value="general">General/Whole body</option>
                        </select>
                    </div>

                    <!-- Duration -->
                    <div class="mb-4">
                        <label for="duration" class="block text-sm font-semibold text-gray-700 mb-2">
                            üìÖ Duration of symptoms *
                        </label>
                        <select 
                            id="duration" 
                            name="duration"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition" 
                            required
                        >
                            <option value="" disabled selected>Select duration...</option>
                            <option value="less-than-1-hour">Less than 1 hour</option>
                            <option value="1-24-hours">1-24 hours</option>
                            <option value="1-7-days">1-7 days</option>
                            <option value="1-4-weeks">1-4 weeks</option>
                            <option value="more-than-1-month">More than 1 month</option>
                        </select>
                    </div>

                    <!-- Severity -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            üìä Severity Rating *
                        </label>
                        <div class="grid grid-cols-3 gap-4">
                            <label class="cursor-pointer">
                                <input type="radio" name="severity" value="mild" class="peer hidden" required>
                                <div class="border-2 border-gray-300 peer-checked:border-green-500 peer-checked:bg-green-50 rounded-lg p-4 text-center transition hover:border-green-400">
                                    <div class="text-4xl mb-2">üòä</div>
                                    <div class="font-semibold text-green-700">Mild</div>
                                    <div class="text-xs text-gray-600">Manageable</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="severity" value="moderate" class="peer hidden">
                                <div class="border-2 border-gray-300 peer-checked:border-yellow-500 peer-checked:bg-yellow-50 rounded-lg p-4 text-center transition hover:border-yellow-400">
                                    <div class="text-4xl mb-2">üòê</div>
                                    <div class="font-semibold text-yellow-700">Moderate</div>
                                    <div class="text-xs text-gray-600">Significant</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="severity" value="severe" class="peer hidden">
                                <div class="border-2 border-gray-300 peer-checked:border-red-500 peer-checked:bg-red-50 rounded-lg p-4 text-center transition hover:border-red-400">
                                    <div class="text-4xl mb-2">üò£</div>
                                    <div class="font-semibold text-red-700">Severe</div>
                                    <div class="text-xs text-gray-600">Very painful</div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Red Flags -->
                <div class="border-l-4 border-red-600 pl-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        ‚ö†Ô∏è Emergency Warning Signs
                    </label>
                    <div class="bg-red-50 border-2 border-red-200 rounded-lg p-5">
                        <div class="space-y-3">
                            <label class="flex items-center cursor-pointer hover:bg-red-100 p-2 rounded">
                                <input type="checkbox" name="red-flags" value="chest-pain" class="mr-3 w-4 h-4">
                                <span class="text-gray-800">üíî Chest pain or pressure</span>
                            </label>
                            <label class="flex items-center cursor-pointer hover:bg-red-100 p-2 rounded">
                                <input type="checkbox" name="red-flags" value="breathing" class="mr-3 w-4 h-4">
                                <span class="text-gray-800">üòÆ‚Äçüí® Severe difficulty breathing</span>
                            </label>
                            <label class="flex items-center cursor-pointer hover:bg-red-100 p-2 rounded">
                                <input type="checkbox" name="red-flags" value="confusion" class="mr-3 w-4 h-4">
                                <span class="text-gray-800">üòµ Confusion or altered consciousness</span>
                            </label>
                            <label class="flex items-center cursor-pointer hover:bg-red-100 p-2 rounded">
                                <input type="checkbox" name="red-flags" value="bleeding" class="mr-3 w-4 h-4">
                                <span class="text-gray-800">ü©∏ Severe bleeding</span>
                            </label>
                            <label class="flex items-center cursor-pointer hover:bg-red-100 p-2 rounded">
                                <input type="checkbox" name="red-flags" value="high-fever" class="mr-3 w-4 h-4">
                                <span class="text-gray-800">üå°Ô∏è Very high fever with confusion</span>
                            </label>
                            <label class="flex items-center cursor-pointer hover:bg-green-100 p-2 rounded border-t-2 border-green-200 mt-3 pt-3">
                                <input type="checkbox" name="red-flags" value="none" class="mr-3 w-4 h-4">
                                <span class="text-gray-800 font-bold">‚úÖ None of these</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <button 
                    type="submit" 
                    id="submit-btn"
                    class="w-full bg-gradient-to-r from-teal-600 to-blue-600 text-white py-4 px-6 rounded-lg font-bold text-lg hover:from-teal-700 hover:to-blue-700 transition transform hover:scale-105 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    <span class="flex items-center justify-center">
                        <span class="text-2xl mr-3">üîç</span>
                        <span>Get Care Recommendation</span>
                    </span>
                </button>
            </form>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden"></div>
        
    </div>

    <!-- Footer -->
    <div class="bg-gradient-to-r from-teal-600 to-blue-600 mt-12 py-8">
        <div class="max-w-4xl mx-auto px-4 text-center text-white">
            <div class="mb-4">
                <div class="inline-block bg-white rounded-full p-3 mb-2">
                    <span class="text-3xl">üè•</span>
                </div>
                <h3 class="text-2xl font-bold">Uzima Healthcare</h3>
                <p class="text-teal-100 text-sm">Comprehensive Smart Triage System</p>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCuIJN_dMJyutgBM-WjSRtHvGcqECfd73E",
            authDomain: "uzima-healthcare.firebaseapp.com",
            projectId: "uzima-healthcare",
            storageBucket: "uzima-healthcare.firebasestorage.app",
            messagingSenderId: "7640251385",
            appId: "1:7640251385:web:f40a7d601e68b7aa255b28"
        };

        // Initialize Firebase
        let db = null;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log('‚úÖ Firebase initialized');
        } catch (error) {
            console.error('‚ùå Firebase error:', error);
        }

        // Demo Data
        const demoPatients = [
            {
                phone: "+254712345678", name: "Grace Wanjiru", age: "28", gender: "female",
                weight: "65", height: "165", location: "Nairobi", allergies: "None",
                medications: "None", travel: "no",
                chiefComplaint: "Burning sensation when urinating, frequent urge to urinate, lower abdominal discomfort",
                bodyLocation: "abdomen", duration: "1-7-days", severity: "moderate", redFlags: ["none"]
            },
            {
                phone: "+254723456789", name: "John Kamau", age: "65", gender: "male",
                weight: "78", height: "172", location: "Nairobi", allergies: "None",
                medications: "Aspirin daily", travel: "no",
                chiefComplaint: "Severe chest pain radiating to left arm, shortness of breath, heavy sweating, nausea",
                bodyLocation: "chest", duration: "less-than-1-hour", severity: "severe", redFlags: ["chest-pain", "breathing"]
            },
            {
                phone: "+254734567890", name: "Mary Achieng", age: "32", gender: "female",
                weight: "60", height: "160", location: "Kisumu", allergies: "Peanuts",
                medications: "None", travel: "no",
                chiefComplaint: "Mild headache, runny nose, slight cough, feeling tired",
                bodyLocation: "head", duration: "1-24-hours", severity: "mild", redFlags: ["none"]
            },
            {
                phone: "+254745678901", name: "Peter Ochieng", age: "45", gender: "male",
                weight: "72", height: "175", location: "Mombasa", allergies: "None",
                medications: "None", travel: "international",
                chiefComplaint: "Persistent cough for 3 weeks, night sweats, unexplained weight loss, fatigue",
                bodyLocation: "chest", duration: "1-4-weeks", severity: "moderate", redFlags: ["none"]
            }
        ];

        function loadDemo(index) {
            const p = demoPatients[index];
            document.getElementById('phone').value = p.phone;
            document.getElementById('patient-name').value = p.name;
            document.getElementById('patient-age').value = p.age;
            document.getElementById('gender').value = p.gender;
            if (p.weight) document.getElementById('weight').value = p.weight;
            if (p.height) document.getElementById('height').value = p.height;
            if (p.location) document.getElementById('location').value = p.location;
            if (p.allergies) document.getElementById('allergies').value = p.allergies;
            if (p.medications) document.getElementById('medications').value = p.medications;
            document.querySelector(`input[name="travel"][value="${p.travel}"]`).checked = true;
            document.getElementById('chief-complaint').value = p.chiefComplaint;
            if (p.bodyLocation) document.getElementById('body-location').value = p.bodyLocation;
            document.getElementById('duration').value = p.duration;
            document.querySelector(`input[name="severity"][value="${p.severity}"]`).checked = true;
            
            document.querySelectorAll('input[name="red-flags"]').forEach(cb => cb.checked = false);
            p.redFlags.forEach(flag => {
                const checkbox = document.querySelector(`input[name="red-flags"][value="${flag}"]`);
                if (checkbox) checkbox.checked = true;
            });

            document.getElementById('triage-form-container').scrollIntoView({ behavior: 'smooth' });
        }

        // Triage Logic
        function triagePatient(formData) {
            const { chiefComplaint, duration, severity, redFlags } = formData;
            const complaint = chiefComplaint.toLowerCase();
            
            const dangerousFlags = redFlags.filter(flag => flag !== 'none');
            if (dangerousFlags.length > 0) {
                return {
                    level: 'EMERGENCY', priority: 1, color: 'RED', icon: 'üö®',
                    action: 'Go to Emergency Department IMMEDIATELY', waitTime: 'IMMEDIATE',
                    provider: 'Emergency Physician',
                    reasoning: 'Life-threatening symptoms detected.',
                    instructions: ['Call 999 or go to Emergency NOW', 'Do NOT wait', 'Inform staff immediately']
                };
            }
            
            const nurseKeywords = ['uti', 'urinary', 'burning', 'refill', 'blood pressure', 'diabetes'];
            if (nurseKeywords.some(k => complaint.includes(k)) && (severity === 'mild' || severity === 'moderate')) {
                return {
                    level: 'NURSE CONSULTATION', priority: 3, color: 'GREEN', icon: 'üë©‚Äç‚öïÔ∏è',
                    action: 'See nurse or clinical officer', waitTime: '15-20 minutes',
                    provider: 'Clinical Nurse/Officer',
                    reasoning: 'Your condition can be managed by nursing staff.',
                    instructions: ['Check in at nurse station', 'Show your reference number', 'Nurse will assess and treat']
                };
            }
            
            const selfCareKeywords = ['cold', 'runny nose', 'mild headache', 'slight cough'];
            const isRecent = duration === '1-24-hours' || duration === 'less-than-1-hour';
            if (selfCareKeywords.some(k => complaint.includes(k)) && severity === 'mild' && isRecent) {
                return {
                    level: 'SELF-CARE', priority: 4, color: 'BLUE', icon: 'üè†',
                    action: 'Home care recommended', waitTime: 'No clinic visit needed',
                    provider: 'Self-management',
                    reasoning: 'Symptoms are mild and recent. Try home care first.',
                    instructions: ['Get plenty of rest', 'Stay hydrated', 'Over-the-counter pain relief if needed', 'Call clinic if symptoms worsen']
                };
            }
            
            return {
                level: 'PHYSICIAN CONSULTATION', priority: 2, color: 'YELLOW', icon: 'üë®‚Äç‚öïÔ∏è',
                action: 'See medical doctor', waitTime: '30-40 minutes',
                provider: 'Medical Doctor',
                reasoning: 'Your symptoms require physician evaluation.',
                instructions: ['Check in at reception', 'Doctor will examine you', 'Tests may be ordered', 'Treatment plan will be provided']
            };
        }

        // Form submission
        document.getElementById('triage-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="flex items-center justify-center"><span class="animate-spin mr-3">‚è≥</span><span>Processing...</span></span>';
            
            const formData = {
                phone: document.getElementById('phone').value,
                name: document.getElementById('patient-name').value,
                age: document.getElementById('patient-age').value,
                gender: document.getElementById('gender').value,
                weight: document.getElementById('weight').value || null,
                height: document.getElementById('height').value || null,
                location: document.getElementById('location').value || null,
                allergies: document.getElementById('allergies').value || 'None',
                medications: document.getElementById('medications').value || 'None',
                travel: document.querySelector('input[name="travel"]:checked').value,
                chiefComplaint: document.getElementById('chief-complaint').value,
                bodyLocation: document.getElementById('body-location').value || 'Not specified',
                duration: document.getElementById('duration').value,
                severity: document.querySelector('input[name="severity"]:checked').value,
                redFlags: Array.from(document.querySelectorAll('input[name="red-flags"]:checked')).map(cb => cb.value),
                source: 'web',
                timestamp: new Date().toISOString()
            };
            
            const triageResult = triagePatient(formData);
            
            try {
                const refId = 'WEB' + Date.now().toString().slice(-8);
                
                if (db !== null) {
                    await db.collection('assessments').add({
                        ...formData,
                        triageLevel: triageResult.level,
                        triageAction: triageResult.action,
                        triagePriority: triageResult.priority,
                        triageColor: triageResult.color,
                        expectedWait: triageResult.waitTime,
                        provider: triageResult.provider,
                        reasoning: triageResult.reasoning,
                        instructions: triageResult.instructions,
                        status: 'waiting',
                        queueNumber: generateQueueNumber(triageResult.priority),
                        refId: refId,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    console.log('‚úÖ Saved to Firebase');
                } else {
                    console.log('‚ö†Ô∏è Firebase not initialized');
                }
                
                displayResult(triageResult, formData, refId);
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                const refId = 'WEB' + Date.now().toString().slice(-8);
                displayResult(triageResult, formData, refId);
            }
        });

        function generateQueueNumber(priority) {
            const prefix = { 1: 'E', 2: 'D', 3: 'N', 4: 'S' };
            const number = Math.floor(Math.random() * 999) + 1;
            return `${prefix[priority]}${number.toString().padStart(3, '0')}`;
        }

        function displayResult(result, formData, refId) {
            const resultsDiv = document.getElementById('results');
            const formDiv = document.getElementById('triage-form-container');
            const demoButtons = document.getElementById('demo-buttons');
            
            formDiv.classList.add('hidden');
            demoButtons.classList.add('hidden');
            resultsDiv.classList.remove('hidden');
            resultsDiv.classList.add('fade-in');
            
            const colorMap = {
                'RED': { bg: 'bg-red-100', border: 'border-red-500', text: 'text-red-900', badge: 'bg-red-600' },
                'YELLOW': { bg: 'bg-yellow-100', border: 'border-yellow-500', text: 'text-yellow-900', badge: 'bg-yellow-600' },
                'GREEN': { bg: 'bg-green-100', border: 'border-green-500', text: 'text-green-900', badge: 'bg-green-600' },
                'BLUE': { bg: 'bg-blue-100', border: 'border-blue-500', text: 'text-blue-900', badge: 'bg-blue-600' }
            };
            
            const colors = colorMap[result.color];
            const queueNum = generateQueueNumber(result.priority);
            
            resultsDiv.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl p-8 mb-6 border-t-8 ${colors.border}">
                    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-6 rounded-xl mb-6 text-center">
                        <div class="text-sm font-semibold mb-2">YOUR QUEUE POSITION</div>
                        <div class="text-5xl font-bold mb-2">${queueNum}</div>
                        <div class="text-lg font-semibold mt-2">Estimated wait: ${result.waitTime}</div>
                    </div>

                    <div class="${colors.bg} p-6 rounded-xl mb-6 border-2 ${colors.border}">
                        <div class="flex items-center mb-4">
                            <span class="text-6xl mr-4">${result.icon}</span>
                            <div>
                                <h2 class="text-3xl font-bold ${colors.text}">${result.action}</h2>
                                <span class="${colors.badge} text-white px-4 py-2 rounded-full text-sm font-bold inline-block mt-2">
                                    ${result.level}
                                </span>
                            </div>
                        </div>
                        <p class="text-lg ${colors.text} mb-4">${result.reasoning}</p>
                    </div>

                    <div class="bg-indigo-50 p-6 rounded-xl mb-6">
                        <h3 class="text-xl font-bold mb-4">üìã Next Steps</h3>
                        <ul class="space-y-2">
                            ${result.instructions.map(step => `
                                <li class="flex items-start">
                                    <span class="text-indigo-600 mr-2">‚Üí</span>
                                    <span>${step}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>

                    <div class="bg-gray-50 p-6 rounded-xl mb-6">
                        <h3 class="text-xl font-bold mb-4">üìä Assessment Summary</h3>
                        <div class="grid md:grid-cols-2 gap-4 text-sm">
                            <div><strong>Reference:</strong> ${refId}</div>
                            <div><strong>Queue:</strong> ${queueNum}</div>
                            <div><strong>Name:</strong> ${formData.name}</div>
                            <div><strong>Age:</strong> ${formData.age}</div>
                            <div><strong>Gender:</strong> ${formData.gender}</div>
                            <div><strong>Phone:</strong> ${formData.phone}</div>
                            ${formData.location ? `<div><strong>Location:</strong> ${formData.location}</div>` : ''}
                            ${formData.weight ? `<div><strong>Weight:</strong> ${formData.weight} kg</div>` : ''}
                            ${formData.height ? `<div><strong>Height:</strong> ${formData.height} cm</div>` : ''}
                            <div><strong>Allergies:</strong> ${formData.allergies}</div>
                            <div><strong>Medications:</strong> ${formData.medications}</div>
                            <div><strong>Travel:</strong> ${formData.travel}</div>
                            <div class="md:col-span-2"><strong>Symptoms:</strong> ${formData.chiefComplaint}</div>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        <button onclick="resetForm()" class="bg-gray-600 text-white py-3 rounded-lg font-bold hover:bg-gray-700 transition">
                            ‚Üê Assess Another Patient
                        </button>
                        <button onclick="window.print()" class="bg-teal-600 text-white py-3 rounded-lg font-bold hover:bg-teal-700 transition">
                            üñ®Ô∏è Print Summary
                        </button>
                    </div>
                </div>
            `;

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function resetForm() {
            document.getElementById('triage-form-container').classList.remove('hidden');
            document.getElementById('demo-buttons').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('triage-form').reset();
            document.getElementById('submit-btn').disabled = false;
            document.getElementById('submit-btn').innerHTML = '<span class="flex items-center justify-center"><span class="text-2xl mr-3">üîç</span><span>Get Care Recommendation</span></span>';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Prevent "none" checkbox conflict
        document.querySelectorAll('input[name="red-flags"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (this.value === 'none' && this.checked) {
                    document.querySelectorAll('input[name="red-flags"]').forEach(cb => {
                        if (cb.value !== 'none') cb.checked = false;
                    });
                } else if (this.value !== 'none' && this.checked) {
                    document.querySelector('input[name="red-flags"][value="none"]').checked = false;
                }
            });
        });
    </script>
</body>
</html>